<!DOCTYPE html>
<html lang="en">

<head>
  <title>Chat Me</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/assets/css/style.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    ::-webkit-scrollbar {
      width: .2rem;
    }

    ::-webkit-scrollbar-thumb {
      background-color: #ccc;
      width: .1rem;
      border-radius: 1rem;
    }
  </style>
</head>

<body>
  <div class="h-screen w-screen bg-slate-800 overflow-hidden relative  text-slate-100 md:flex" x-data="users">
    <input type="checkbox" id="menu" aria-hidden="true" class="peer hidden" x-ref="menu" />

    <!-- left hand side drawer -->
    <aside
      class="absolute top-0 -left-full transition transition h-full w-full md:w-80 duration-500 peer-checked:translate-x-full bg-slate-800/50 md:static md:shrink-0"
      @click.self="$refs.menu.checked = false">
      <div class="flex flex-col bg-slate-900 h-full w-64 md:w-full justify-between">
        <ul class="flex flex-col gap-4 px-4 py-8 md:px-8 overflow-auto h-3/4">
          <template x-for="user in users">
            <li>
              <button
                class="flex gap-4 items-center bg-slate-600 hover:bg-slate-700 w-full rounded-md p-2 shadow shadow-slate-400/70 transition duration-300 active:shadow-none"
                @click="() => selectChat(user.username)"
                :class="{'ring-[3px] ring-sky-500 ring-offset-[3px] ring-offset-slate-900': user.username === chatWith}">
                <div class="h-12 w-12">
                  <img :src="user?.avatarImage" />
                </div>
                <p x-text="user?.username"></p>
              </button>
            </li>
          </template>
        </ul>

        <div>
          <div class="flex items-center shrink-0 justify-center p-8 gap-4">
            <img class="h-16 w-16" :src="me?.avatarImage" :alt="`avatar of ${me?.username}`" />
            <span class="text-2xl font-bold" x-text="me?.username"></span>
          </div>
          <form action="/login" method="DELETE">
            <button
              class="text-center gap-4 bg-slate-600 hover:bg-slate-700 w-full p-2 transition duration-300 uppercase">Log
              out</button>
          </form>
        </div>
      </div>
    </aside>

    <div class="p-4 md:px-8 grow flex flex-col h-full">
      <section class="flex justify-between items-center m-2">
        <h2 class="font-bold text-2xl flex items-center gap-4">
          <span class="inline-block h-12 w-12"><img :src="currentChat?.avatarImage" /></span>
          <span x-text="currentChat?.username"></span>
        </h2>
        <label for="menu"
          class="px-4 py-3 rounded-lg bg-slate-600 py-2 font-bold uppercase shadow shadow-slate-600 transition hover:bg-slate-700 active:shadow-none md:hidden">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </label>
      </section>

      <main class="grow">
        <section x-show="!currentChat" class="flex flex-col items-center justify-center">
          <div> <img src="/assets/images/robot.gif" alt="welcome robot" /></div>
          <div class="text-center">
            <h1 class="font-bold text-2xl md:text-3xl monospace">Welcome <span class="text-green-300"
                x-text="me?.username"></span>!</h1>
            <p>Please select a chat to start messaging.</p>
          </div>
        </section>

        <section x-show="currentChat" class="flex flex-col justify-between h-full">
          <div>
            chat texts will be here
          </div>

          <form class="flex gap-2 relative" @submit.prevent="send" x-data="{isEmojiOpen: false}">
            <emoji-picker id="emoji-picker" class="absolute bottom-16" x-show="isEmojiOpen"></emoji-picker>
            <button @click="isEmojiOpen = !isEmojiOpen"
              class="text-center bg-slate-600 hover:bg-slate-700 rounded-md grow-0 self-center p-2 shadow-sm shadow-slate-400/70 transition duration-300 active:shadow-none uppercase"><svg
                xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="M14.36 14.23a3.76 3.76 0 0 1-4.72 0a1 1 0 0 0-1.28 1.54a5.68 5.68 0 0 0 7.28 0a1 1 0 1 0-1.28-1.54ZM9 11a1 1 0 1 0-1-1a1 1 0 0 0 1 1Zm6-2a1 1 0 1 0 1 1a1 1 0 0 0-1-1Zm-3-7a10 10 0 1 0 10 10A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8a8 8 0 0 1-8 8Z" />
              </svg></button>
            <input type="text" id="message" name="message" placeholder="Aa..." x-model="message" autocomplete="off">
            <button
              class="text-center bg-slate-600 hover:bg-slate-700 rounded-md grow-0 self-center p-4 shadow-sm shadow-slate-400/70 transition duration-300 active:shadow-none">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                <path fill="currentColor"
                  d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26l.001.002l4.995 3.178l3.178 4.995l.002.002l.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215l7.494-7.494l1.178-.471l-.47 1.178Z" />
              </svg>
            </button>
          </form>

        </section>
      </main>
    </div>

  </div>

  <script src="/assets/js/chat.js"></script>
  <script type="module">
    import 'https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js'
    import insertText from 'https://cdn.jsdelivr.net/npm/insert-text-at-cursor@0.3.0/index.js'

    document.getElementById('emoji-picker').addEventListener('emoji-click', e => {
      insertText(document.getElementById('message'), e.detail.unicode)
    })
  </script>

</body>

</html>
